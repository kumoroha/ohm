<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>é›»å­å·¥ä½œ ç©¶æ¥µã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ãƒ„ãƒ¼ãƒ«</title>
    <style>
        :root { --primary: #0284c7; --bg: #f1f5f9; --card: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #334155; padding: 20px; line-height: 1.4; }
        .container { max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); gap: 20px; align-items: start; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); min-height: 360px; }
        h2 { font-size: 1.1em; color: var(--primary); border-bottom: 2px solid #e2e8f0; padding-bottom: 6px; margin: 0 0 12px 0; }
        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.85em; font-weight: bold; color: #64748b; margin-bottom: 4px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; font-size: 1em; }
        .result-box { margin-top: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px; border: 1px solid #bae6fd; font-size: 1em; line-height: 1.5; }
        .res-val { color: #0369a1; font-weight: bold; font-size: 1.25em; }
        .hint { font-size: 0.8em; color: #94a3b8; margin-top: 4px; }
        .band-row { display: flex; gap: 4px; margin-top: 8px; }
        .band-select { flex: 1; height: 45px; border-radius: 6px; cursor: pointer; border: 1px solid #ccc; font-weight: bold; text-align: center; font-size: 0.8em; }
        
        details { background: var(--card); margin-top: 30px; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden; }
        summary { padding: 15px 20px; font-weight: bold; cursor: pointer; background: #e2e8f0; color: #1e293b; outline: none; }
        .details-content { padding: 20px; }
        .ascii-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .ascii-art { font-family: 'Consolas', 'Monaco', 'Courier New', monospace; background: #1e293b; color: #00ff41; padding: 20px; border-radius: 8px; font-size: 0.85em; line-height: 1.2; overflow-x: auto; white-space: pre; }
        .ascii-title { color: #fff; font-weight: bold; margin-bottom: 10px; display: block; text-decoration: underline; }
        
        .glossary { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9em; background: #fff; }
        .glossary th, .glossary td { border: 1px solid #cbd5e1; padding: 10px; text-align: left; }
        .glossary th { background: #f8fafc; color: var(--primary); width: 25%; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color:#1e293b; margin-bottom:25px;">é›»å­å·¥ä½œ ç©¶æ¥µã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ãƒ„ãƒ¼ãƒ«</h1>

    <div class="grid">
        <div class="card">
            <h2>1. LEDæŠµæŠ—è¨­è¨ˆ</h2>
            <div class="input-group"><label>é›»æºé›»åœ§ (Vcc) [V]</label><input type="number" id="vcc" value="4.5" step="0.1" oninput="calc()"></div>
            <div class="input-group"><label><input type="checkbox" id="use_drop" checked onchange="calc()" style="width:auto;"> ICãƒ‰ãƒ­ãƒƒãƒ—è€ƒæ…®(-1.0V)</label></div>
            <div class="input-group"><label>LEDã®Vf [V]</label><input type="number" id="vf" value="3.1" step="0.1" oninput="calc()"></div>
            <div class="input-group"><label>åˆ—æ•° (ä¸¦åˆ—æ•°)</label><input type="number" id="parallel" value="1" min="1" oninput="calc()"></div>
            <div class="input-group"><label>ç›®æ¨™é›»æµ [mA/åˆ—]</label><input type="number" id="target_ma" value="20" oninput="calc()"></div>
            <div class="result-box" id="res_led">---</div>
        </div>

        <div class="card">
            <h2>2. NE555 ã‚¿ã‚¤ãƒãƒ¼è¨­å®š</h2>
            <div class="input-group"><label>å‹•ä½œãƒ¢ãƒ¼ãƒ‰</label><select id="mode" onchange="calc()"><option value="astable">ç„¡å®‰å®š (ç‚¹æ»…)</option><option value="mono">å˜å®‰å®š (ãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆ)</option></select></div>
            <div class="input-group"><label>ã‚³ãƒ³ãƒ‡ãƒ³ã‚µ [Î¼F]</label><input type="number" id="c1" value="100" oninput="calc()"></div>
            <div class="input-group"><label>æŠµæŠ— RA [kÎ©]</label><input type="number" id="ra" value="10" oninput="calc()"></div>
            <div id="rb_group" class="input-group"><label>æŠµæŠ— RB [kÎ©]</label><input type="number" id="rb" value="47" oninput="calc()"></div>
            <div class="result-box" id="res_555">---</div>
        </div>

        <div class="card">
            <h2>3. NE555 é€†å¼•ã</h2>
            <div class="input-group"><label>ã€å˜å®‰å®šã€‘ç›®æ¨™æ™‚é–“ [ç§’]</label><input type="number" id="target_sec" value="1.0" step="0.1" oninput="calc()"></div>
            <div class="result-box" id="res_mono_inv">---</div>
            <div class="input-group" style="margin-top:20px;"><label>ã€ç„¡å®‰å®šã€‘ç›®æ¨™å‘¨æ³¢æ•° [Hz]</label><input type="number" id="target_hz" value="1.0" step="0.1" oninput="calc()"></div>
            <div class="result-box" id="res_astable_inv">---</div>
        </div>

        <div class="card">
            <h2>4. åˆæˆæŠµæŠ—è¨ˆç®—</h2>
            <div class="input-group"><label>æŠµæŠ—1 [Î©]</label><input type="number" id="comb_r1" value="100" oninput="calc()"></div>
            <div class="input-group"><label>æŠµæŠ—2 [Î©]</label><input type="number" id="comb_r2" value="100" oninput="calc()"></div>
            <div class="result-box">ç›´åˆ—: <span class="res-val" id="res_series">---</span> Î©<br>ä¸¦åˆ—: <span class="res-val" id="res_parallel">---</span> Î©</div>
        </div>

        <div class="card">
            <h2>5. æŠµæŠ—ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰è§£èª­ (4/5æœ¬å¯¾å¿œ)</h2>
            <div class="input-group"><select id="res_type" onchange="toggleFifthBand();calc()"><option value="4">ä¸€èˆ¬æŠµæŠ— (4æœ¬å¸¯)</option><option value="5">ç²¾å¯†æŠµæŠ— (5æœ¬å¸¯)</option></select></div>
            <div class="band-row">
                <select id="b1" class="band-select" onchange="updateBandColor(this);calc()"></select>
                <select id="b2" class="band-select" onchange="updateBandColor(this);calc()"></select>
                <select id="b5" class="band-select" onchange="updateBandColor(this);calc()" style="display:none;"></select>
                <select id="b3" class="band-select" onchange="updateBandColor(this);calc()"></select>
                <select id="b4" class="band-select" onchange="updateBandColor(this);calc()"></select>
            </div>
            <div class="result-box" id="res_color">---</div>
            <p class="hint" id="band_label">ç¬¬1 | ç¬¬2 | ä¹—æ•° | ç²¾åº¦</p>
        </div>

        <div class="card">
            <h2>6. æŠµæŠ—å€¤ã‹ã‚‰é›»æµè¨ˆç®— (é€†å¼•ã)</h2>
            <div class="input-group"><label>ä½¿ç”¨ã™ã‚‹æŠµæŠ—å€¤ [Î©]</label><input type="number" id="r_stock" value="100" oninput="calc()"></div>
            <div class="result-box" id="res_stock_ma">---</div>
        </div>
    </div>

    <details>
        <summary>ğŸ’¡ NE555 æ¥ç¶šå›³ & ç”¨èªè§£èª¬ã‚’è¡¨ç¤º</summary>
        <div class="details-content">
            <div class="ascii-grid">
                <div class="ascii-art">
<span class="ascii-title">ã€ç„¡å®‰å®šï¼šç‚¹æ»…ãƒ¢ãƒ¼ãƒ‰ã€‘</span>
        VCC (+)
         |
    +----+----+
    |         |
   [RA]      (8)VCC
    |         |
    +---(7)DISCH
    |         |
   [RB]       |      NE555 ãƒ”ãƒ³é…ç½®
    |         |     +-------U-------+
    +---(6)THRESH  1| GND       VCC |8 --- VCC
    |         |    2| TRIG    DISCH |7 --- (RA-RBé–“)
    +---(2)TRIG    3| OUT    THRESH |6 --- (RB-C1é–“)
    |              4| RESET    CONT |5 --- (103ç­‰ã§GNDã¸æ¨å¥¨)
   [C1]             +---------------+
    |                |
   GND (-)          (1)GND --- GND
                </div>
                <div class="ascii-art">
<span class="ascii-title">ã€å˜å®‰å®šï¼šã‚¿ã‚¤ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰ã€‘</span>
        VCC (+)
         |
    +----+----+
    |         |
   [RA]      (8)VCC
    |         |
    +---(7)DISCH    NE555 ãƒ”ãƒ³é…ç½®
    |        |     +-------U-------+
    +---(6)THRESH  1| GND       VCC |8 --- VCC
    |              2| TRIG    DISCH |7 --- (RAä¸‹)
   [C1]            3| OUT    THRESH |6 --- (RAä¸‹)
    |              4| RESET    CONT |5
   GND (-)         +---------------+
                    |
 (Pin2) TRIG å…¥åŠ› --+  (GNDã«è½ã¨ã™ã¨ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹)
                </div>
            </div>
            <h2>ç”¨èªãƒ»ç•¥èªã®è§£èª¬</h2>
            <table class="glossary">
                <tr><th>GND (1)</th><td>ã‚°ãƒ©ãƒ³ãƒ‰ã€‚é›»æºã®ãƒã‚¤ãƒŠã‚¹å´ã€‚åŸºæº–ã¨ãªã‚‹0Vã§ã™ã€‚</td></tr>
                <tr><th>TRIG (2)</th><td>ãƒˆãƒªã‚¬ãƒ¼ã€‚2ç•ªãƒ”ãƒ³ã®é›»åœ§ãŒé›»æºã®1/3ä»¥ä¸‹ã«ãªã‚‹ã¨ã‚¿ã‚¤ãƒãƒ¼ãŒå§‹å‹•ã—ã¾ã™ã€‚</td></tr>
                <tr><th>OUT (3)</th><td>å‡ºåŠ›ã€‚ã“ã“ã‹ã‚‰LEDã‚„ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãªã©ã«ä¿¡å·ï¼ˆé›»æµï¼‰ã‚’é€ã‚Šã¾ã™ã€‚</td></tr>
                <tr><th>RESET (4)</th><td>ãƒªã‚»ãƒƒãƒˆã€‚ã‚¿ã‚¤ãƒãƒ¼ã‚’å¼·åˆ¶åœæ­¢ã—ã¾ã™ã€‚ä½¿ã‚ãªã„æ™‚ã¯VCCã«ç¹‹ãã¾ã™ã€‚</td></tr>
                <tr><th>CONT (5)</th><td>ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã€‚å†…éƒ¨åŸºæº–é›»åœ§ã€‚é€šå¸¸ã¯0.01Î¼F(103)ã®ã‚³ãƒ³ãƒ‡ãƒ³ã‚µã‚’ä»‹ã—ã¦GNDã¸ã€‚</td></tr>
                <tr><th>THRESH (6)</th><td>ã‚¹ãƒ¬ãƒƒã‚·ãƒ§ãƒ«ãƒ‰ã€‚C1ã®é›»åœ§ãŒé›»æºã®2/3ã‚’è¶…ãˆã‚‹ã¨å‡ºåŠ›ã‚’Lã«ã—ã¾ã™ã€‚</td></tr>
                <tr><th>DISCH (7)</th><td>ãƒ‡ã‚£ã‚¹ãƒãƒ£ãƒ¼ã‚¸ã€‚ã‚³ãƒ³ãƒ‡ãƒ³ã‚µ(C1)ã®é›»æ°—ã‚’æ”¾é›»ï¼ˆç©ºã«ï¼‰ã™ã‚‹ãŸã‚ã®é€šã‚Šé“ã§ã™ã€‚</td></tr>
                <tr><th>VCC (8)</th><td>é›»æºã€‚é›»æ± ã®ãƒ—ãƒ©ã‚¹å´ãªã©ã‚’ç¹‹ãã¾ã™ã€‚</td></tr>
            </table>
        </div>
    </details>
</div>

<script>
const COLORS = [
    {n:"é»’", v:0, m:1, c:"#000", t:null}, {n:"èŒ¶", v:1, m:10, c:"#8b4513", t:1},
    {n:"èµ¤", v:2, m:100, c:"#f00", t:2}, {n:"æ©™", v:3, m:1000, c:"#ffa500", t:null},
    {n:"é»„", v:4, m:10000, c:"#ffff00", t:null}, {n:"ç·‘", v:5, m:100000, c:"#008000", t:0.5},
    {n:"é’", v:6, m:1000000, c:"#0000ff", t:0.25}, {n:"ç´«", v:7, m:10000000, c:"#800080", t:0.1},
    {n:"ç°", v:8, m:null, c:"#808080", t:0.05}, {n:"ç™½", v:9, m:null, c:"#fff", t:null},
    {n:"é‡‘", v:null, m:0.1, c:"#daa520", t:5}, {n:"éŠ€", v:null, m:0.01, c:"#c0c0c0", t:10}
];

function init() {
    ["b1", "b2", "b5", "b3", "b4"].forEach((id) => {
        const sel = document.getElementById(id);
        COLORS.forEach((c, i) => {
            if((id==="b1"||id==="b2"||id==="b5") && c.v === null) return;
            if(id==="b3" && c.m === null) return;
            if(id==="b4" && c.t === null) return;
            const opt = new Option(c.n, i);
            opt.style.backgroundColor = c.c;
            opt.style.color = (i === 4 || i === 9 || i === 10 || i === 11) ? "black" : "white";
            sel.add(opt);
        });
        sel.value = (id==="b1")?1 : (id==="b2")?0 : (id==="b5")?0 : (id==="b3")?2 : 10;
        updateBandColor(sel);
    });
    calc();
}

function toggleFifthBand() {
    const is5 = document.getElementById('res_type').value === "5";
    document.getElementById('b5').style.display = is5 ? "block" : "none";
}

function updateBandColor(el) {
    const v = parseInt(el.value);
    el.style.backgroundColor = COLORS[v].c;
    el.style.color = (v === 4 || v === 9 || v === 10 || v === 11) ? "black" : "white";
}

function getE24(val) {
    const e24 = [1.0, 1.1, 1.2, 1.3, 1.5, 1.6, 1.8, 2.0, 2.2, 2.4, 2.7, 3.0, 3.3, 3.6, 3.9, 4.3, 4.7, 5.1, 5.6, 6.2, 6.8, 7.5, 8.2, 9.1];
    if (val <= 0 || !isFinite(val)) return 0;
    const log10 = Math.floor(Math.log10(val));
    const factor = Math.pow(10, log10);
    const base = val / factor;
    const closest = e24.reduce((prev, curr) => Math.abs(curr - base) < Math.abs(prev - base) ? curr : prev);
    return (closest * factor).toFixed(1);
}

// å˜ä½å¤‰æ›é–¢æ•°ï¼ˆMÎ©å¯¾å¿œï¼‰
function formatResistor(val) {
    if (val >= 1000000 && val % 1000000 === 0) {
        return (val / 1000000) + "M";
    } else if (val >= 1000) {
        return (val / 1000).toFixed(1).replace(/\.0$/, '') + "k";
    }
    return Math.round(val);
}

function calc() {
    const vcc = parseFloat(document.getElementById('vcc').value) || 0;
    const vf = parseFloat(document.getElementById('vf').value) || 0;
    const v_eff = vcc - (document.getElementById('use_drop').checked ? 1.0 : 0);
    const targetMa = parseFloat(document.getElementById('target_ma').value) || 0;

    if (v_eff > vf) {
        const r_ideal = (v_eff - vf) / (targetMa / 1000);
        document.getElementById('res_led').innerHTML = `æ¨å¥¨æŠµæŠ—: <span class="res-val">${Math.round(r_ideal)}</span> Î© (E24: ${getE24(r_ideal)}Î©)`;
    } else { document.getElementById('res_led').innerHTML = '<span class="warning">é›»åœ§ä¸è¶³</span>'; }

    const mode = document.getElementById('mode').value;
    const c = (parseFloat(document.getElementById('c1').value) || 0) / 1000000;
    const ra = (parseFloat(document.getElementById('ra').value) || 0) * 1000;
    const rb = (parseFloat(document.getElementById('rb').value) || 0) * 1000;
    document.getElementById('rb_group').style.display = (mode === 'astable') ? 'block' : 'none';
    if(mode === 'mono') { document.getElementById('res_555').innerHTML = `ã‚¿ã‚¤ãƒãƒ¼: <span class="res-val">${(1.1 * ra * c).toFixed(2)}</span> ç§’`; }
    else { document.getElementById('res_555').innerHTML = `å‘¨æ³¢æ•°: <span class="res-val">${(1.44 / ((ra + 2 * rb) * c)).toFixed(2)}</span> Hz`; }

    const is5 = document.getElementById('res_type').value === "5";
    let colorVal;
    if(is5) { colorVal = (COLORS[document.getElementById('b1').value].v * 100 + COLORS[document.getElementById('b2').value].v * 10 + COLORS[document.getElementById('b5').value].v) * COLORS[document.getElementById('b3').value].m; }
    else { colorVal = (COLORS[document.getElementById('b1').value].v * 10 + COLORS[document.getElementById('b2').value].v) * COLORS[document.getElementById('b3').value].m; }
    
    // æ”¹è‰¯ã—ãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°ã‚’é©ç”¨
    document.getElementById('res_color').innerHTML = `æŠµæŠ—å€¤: <span class="res-val">${formatResistor(colorVal)}</span> Î© <span class="hint">(Â±${COLORS[document.getElementById('b4').value].t}%)</span>`;

    const rStock = parseFloat(document.getElementById('r_stock').value) || 0;
    const stockMa = (rStock > 0 && v_eff > vf) ? ((v_eff - vf) / rStock) * 1000 : 0;
    document.getElementById('res_stock_ma').innerHTML = `äºˆæ¸¬é›»æµ: <span class="res-val">${stockMa.toFixed(1)}</span> mA/åˆ—`;

    const cr1 = parseFloat(document.getElementById('comb_r1').value) || 0;
    const cr2 = parseFloat(document.getElementById('comb_r2').value) || 0;
    document.getElementById('res_series').innerText = Math.round(cr1 + cr2);
    document.getElementById('res_parallel').innerText = cr1*cr2 ? Math.round((cr1*cr2)/(cr1+cr2)) : 0;
}
init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>é›»å­å·¥ä½œ è¨ˆç®—ãƒ„ãƒ¼ãƒ« Pro</title>
    <style>
        :root { 
            --primary: #0184c7; --bg: #f1f5f9; --card: #ffffff; 
            --text: #233145; --border: #a2a8b0; --result-bg: #f0f9ff;
            --highlight: #32d56e; /* å›è·¯å›³å†…ã®å‹•çš„æ•°å€¤ã®è‰²ï¼ˆç·‘ï¼‰ */
            --label: #14243b; --h1: #222222; --summary: #eeeeee;
            --accent: #f59e0b; /* é€†å¼•ãç”¨ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
        }
        [data-theme="dark"] {
            --primary: #38bdf8; --bg: #1a1a1a; --card: #1e293b; 
            --text: #f1f5f9; --border: #aaaaaa; --result-bg: #1e3a8a;
            --highlight: #4ade80;
            --label: #fafafa; --h1: #dddddd; --summary: #222222;
        }
        body { 
            font-family: 'Segoe UI', 'Meiryo', sans-serif; 
            background: var(--bg); color: var(--text); padding: 20px; 
            transition: 0.3s; line-height: 1.5; 
            font-size: 17px; /* â˜…ã“ã“ã§å…¨ä½“ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æ“ä½œâ˜… */
            margin-top: 0; padding-top: 0;
        }
        .container { max-width: 1200px; margin: auto; }
        .header-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        @media (max-width: 850px) { .grid { grid-template-columns: 1fr; } }
        
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .card.reverse { border-top: 4px solid var(--accent); } /* é€†å¼•ãç”¨ã‚«ãƒ¼ãƒ‰ã®å¼·èª¿ */
        h1 { color: var(--h1); margin: 20px 0 20px 0; }
        h2 { font-size: 1.3em; color: var(--primary); border-bottom: 2px solid var(--border); padding-bottom: 8px; margin: 0 0 15px 0; }
        h2.rev-title { color: var(--accent); }
        label { display: block; font-size: 0.95em; font-weight: bold; color: var(--label); margin-bottom: 5px; }
        
        input, select { 
            width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; 
            background: var(--card); color: var(--text); margin-bottom: 15px; 
            box-sizing: border-box; font-size: 1.1em;
        }
        
        .result-box { padding: 15px; background: var(--result-bg); border-radius: 8px; border: 1px solid var(--primary); min-height: 40px; }
        .result-box.reverse { border-color: var(--accent); }
        .res-val { color: var(--primary); font-weight: bold; font-size: 1.4em; }
        .res-val.rev { color: var(--accent); }
        .theme-toggle { cursor: pointer; padding: 8px 16px; border-radius: 20px; border: 2px solid var(--primary); background: transparent; color: var(--primary); font-weight: bold; font-size: 0.85em; }
        
        .band-row { display: flex; gap: 6px; margin: 15px 0; }
        .band-select { flex: 1; height: 50px; border: 2px solid var(--border); }
        .existence-info { display: block; font-size: 0.75em; color: #ef4444; margin-top: 4px; font-weight: bold; height: 1.1em; }

        details { background: var(--card); margin-top: 30px; border-radius: 12px; border: 1px solid var(--border); overflow: hidden; }
        summary { padding: 15px 20px; font-weight: bold; cursor: pointer; background: var(--summary); font-size: 1.1em; }
        .details-content { padding: 20px; }
        .ascii-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px; }
        .ascii-art { 
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace; 
            background: #222222; color: #ebf5f1; padding: 20px; border-radius: 10px; 
            font-size: 14px; line-height: 1.3; white-space: pre; overflow-x: auto; margin-bottom: 10px;
        }
        .dyn-val { color: var(--highlight); font-weight: bold; }
        
        .glossary th, .glossary td { border: 1px solid var(--border); padding: 12px; font-size: 0.9em; }
        .mode-info { background: rgba(2, 132, 199, 0.05); padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary); margin-bottom: 15px; font-size: 0.95em; }
        a { color: var(--text); } a:hover { color: #536175; }
        
        /* ä¸¦åˆ—è¨ˆç®—ç”¨ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
        .parallel-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; margin-bottom: 15px; }
        .parallel-inputs div { text-align: center; }
        .parallel-inputs label { font-size: 0.8em; }
        .parallel-inputs input { margin-bottom: 5px; text-align: center; }
    </style>
</head>
<body data-theme="dark">

<div class="container">
    <div class="header-area">
        <h1 id="header">é›»å­å·¥ä½œ è¨ˆç®—ãƒ„ãƒ¼ãƒ« Pro</h1>
        <button class="theme-toggle" onclick="toggleTheme()">Dark / Light</button>
    </div>

    <div class="grid">
        <div class="card">
            <h2>1. LEDæŠµæŠ—è¨ˆç®—</h2>
            <label>é›»æºé›»åœ§ (Vcc) [V]</label><input type="number" inputmode="decimal" id="vcc" value="4.5" step="0.1" oninput="calc()">
            <label><input type="checkbox" id="use_drop" onchange="calc()" style="height: 15px; width: 15px; margin-bottom:0;"> ICãƒ‰ãƒ­ãƒƒãƒ—è€ƒæ…® (555å‡ºåŠ›æ™‚ã¯ç´„1Vä½ä¸‹ã—ã¾ã™)</label>
            <div style="margin-top:15px;">
                <label>LED é †æ–¹å‘é›»åœ§ (Vf) [V]</label><input type="number" inputmode="decimal" id="vf" value="3.1" step="0.1" oninput="calc()">
                <label>ç›®æ¨™é›»æµ (If) [mA]</label><input type="number" inputmode="decimal" id="target_ma" value="15" oninput="calc()">
            </div>
            <div class="result-box" id="res_led">---</div>
        </div>

        <div class="card reverse">
            <h2 class="rev-title">1-Rev. LEDå‹•ä½œé€†å¼•ã</h2>
            <label>æ‰‹æŒã¡ã®æŠµæŠ—å€¤ [Î©]</label>
            <input type="number" inputmode="decimal" id="r_stock_rev" value="100" oninput="calc()">
            <div class="result-box reverse">
                <div>æµã‚Œã‚‹é›»æµ: <span class="res-val rev" id="res_rev_ma">---</span> mA</div>
                <div style="font-size: 0.85em; margin-top:5px;">â€»å·¦ã®1.ã§è¨­å®šã—ãŸé›»åœ§(Vcc, Vf)ã‚’åŸºã«è¨ˆç®—ã—ã¾ã™</div>
            </div>
            <p>è¨ˆç®—çµæœã®ç†è«–å€¤+20%ã®ä½™è£•ã‚’æŒã¤ã¹ãã€‚<br>DC4.5Vã®å ´åˆã€<br>3.1Vãªã‚‰100Î©ã€<br>2.0Vãªã‚‰200Î©ãã‚‰ã„ãŒã‚ˆã„ã€‚</p>
        </div>

        <div class="card">
            <h2>2. 555 ã‚¿ã‚¤ãƒãƒ¼è¨ˆç®—</h2>
            <label>è¨ˆç®—ä¸­ã®ãƒ¢ãƒ¼ãƒ‰ï¼ˆä¸‹å›³ã§ä¸¡æ–¹ã®è§£èª¬ãŒè¦‹ã‚Œã¾ã™ï¼‰</label><select id="mode" onchange="calc()"><option value="astable">ç„¡å®‰å®š (ç‚¹æ»…)</option><option value="mono">å˜å®‰å®š (ã‚¿ã‚¤ãƒãƒ¼)</option></select>
            <label>ã‚³ãƒ³ãƒ‡ãƒ³ã‚µ C1 [Î¼F] (å®¹é‡ãŒå¤§ãã„ã»ã©ã‚†ã£ãã‚Šå‹•ãã¾ã™)&nbsp;<a href="https://www.rubycon.co.jp/wp-content/uploads/catalog-aluminum/PK.pdf">PK</a>&emsp;<a href="https://www.nichicon.co.jp/products/pdfs/vr.pdf">VR</a></label><input type="number" inputmode="decimal" id="c1" value="100" step="0.01" oninput="calc()">
            <label>æŠµæŠ— RA [kÎ©] (æŠµæŠ— RAã‚‚æŠµæŠ— RBã‚‚ã€1kÎ©ä»¥ä¸Šã«ã—ã¦ãã ã•ã„)</label><input type="number" inputmode="decimal" id="ra" value="1" step="0.1" oninput="calc()">
            <div id="rb_group"><label>æŠµæŠ— RB [kÎ©] (æŠµæŠ— RAã‚ˆã‚Šåœ§å€’çš„ã«å¤§ããã™ã‚‹ã¨æ¯”ãŒ50%ã«è¿‘ã¥ãã¾ã™)</label><input type="number" inputmode="decimal" id="rb" value="6.8" step="0.1" oninput="calc()"></div>
            <div class="result-box" id="res_555">---</div>
        </div>

        <div class="card reverse">
            <h2 class="rev-title">2-Rev. 555é€†å¼•ã (ç›®æ¨™å€¤ã‹ã‚‰æŠµæŠ—ã‚’æ±ºå®š)</h2>
            <label>ç›®æ¨™ã®æ•°å€¤ (ä¾‹: 1Hzãªã‚‰1.0)</label>
            <div style="display:flex; gap:10px;">
                <input type="number" inputmode="decimal" id="target_val" value="1.0" step="0.1" oninput="calc()" style="flex:2;">
                <select id="target_unit" onchange="calc()" style="flex:1;">
                    <option value="hz">Hz (å›/ç§’)</option>
                    <option value="sec">ç§’ (å‘¨æœŸ/ON)</option>
                </select>
            </div>
            <label>å›ºå®šã™ã‚‹ RA [kÎ©]</label><input type="number" id="ra_fix" value="1" oninput="calc()">
            <div class="result-box reverse" id="res_555_rev">---</div>
            <p style="font-size: 0.85em;">â€»å·¦ã®è¨­å®šã®ã‚³ãƒ³ãƒ‡ãƒ³ã‚µC1ã‚’ä½¿ç”¨ã—ã¦ã€å¿…è¦ãªæŠµæŠ—å€¤ã‚’å‰²ã‚Šå‡ºã—ã¾ã™<br>&emsp;å·¦å´ã§è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰ã‚’ã—ã£ã‹ã‚Šé¸æŠã—ã¦ãã ã•ã„ã€‚çµæœãŒå¤‰ã‚ã‚Šã¾ã™ã€‚</p>
        </div>

        <div class="card">
            <h2>4 & 6. ä¸¦åˆ—åˆæˆæŠµæŠ—è¨ˆç®—</h2>
            <label>ä½¿ç”¨ã™ã‚‹æŠµæŠ—ã®æ•°</label>
            <select id="parallel_count" onchange="updateParallelInputs();calc()">
                <option value="2">2åˆ—</option>
                <option value="3">3åˆ—</option>
                <option value="4">4åˆ—</option>
                <option value="5">5åˆ—</option>
            </select>
            <div id="parallel_inputs_area" class="parallel-inputs">
                </div>
            <div class="result-box">
                åˆæˆå€¤: <span class="res-val" id="res_parallel">---</span> Î©
            </div>
            <p style="font-size: 0.8em; margin-top:10px; color:gray;">â€»ç©ºæ¬„ã‚„0ã¯è¨ˆç®—ã‹ã‚‰é™¤å¤–ã•ã‚Œã¾ã™</p>
        </div>

        <div class="card">
            <h2>5. æŠµæŠ—ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰è§£èª­</h2>
            <label>å¸¯ã®æœ¬æ•°</label>
            <select id="res_type" onchange="toggleFifthBand();calc()"><option value="4">4æœ¬å¸¯ (ä¸€èˆ¬)</option><option value="5">5æœ¬å¸¯ (ç²¾å¯†)</option></select>
            <div class="band-row">
                <select id="b1" class="band-select" onchange="updateBandColor(this);calc()"></select>
                <select id="b2" class="band-select" onchange="updateBandColor(this);calc()"></select>
                <select id="b5" class="band-select" onchange="updateBandColor(this);calc()" style="display:none;"></select>
                <select id="b3" class="band-select" onchange="updateBandColor(this);calc()"></select>
                <select id="b4" class="band-select" onchange="updateBandColor(this);calc()"></select>
            </div>
            <div class="result-box" style="text-align:center;">
                <span id="res_color" class="res-val" style="font-size:1.6em;">---</span>
                <span id="existence_msg_res" class="existence-info"></span>
            </div>
        </div>

        <div class="card" style="grid-column: span 2;">
            <h2>7. ã‚³ãƒ³ãƒ‡ãƒ³ã‚µè§£èª­ (3æ¡ã‚³ãƒ¼ãƒ‰)</h2>
            <div style="display:flex; gap:15px; align-items:center;">
                <div style="flex:1;">
                    <label>ã‚³ãƒ¼ãƒ‰ (ä¾‹: 104 = 0.1Î¼F)</label>
                    <input type="text" inputmode="numeric" id="cap_code" value="104" maxlength="3" oninput="calc()" style="font-size:1.2em; text-align:center; margin-bottom:0;">
                </div>
                <div style="flex:2;" class="result-box">
                    å®¹é‡: <span id="res_cap" class="res-val" style="font-size:1.4em;">---</span>
                    <span id="existence_msg_cap" class="existence-info"></span>
                </div>
            </div>
        </div>
    </div>

    <details open>
        <summary>ğŸ’¡ å›è·¯å›³ã¨ä½¿ã„æ–¹ã®ãƒã‚¤ãƒ³ãƒˆ (ãƒ”ãƒ³åã®å‰ã®ã‹ã£ã“å†…ã¯ãƒ”ãƒ³ç•ªå·)</summary>
        <div class="details-content">
            <div class="ascii-grid">
                <div>
                    <div class="mode-info">
                        <b>ã€ç„¡å®‰å®šãƒ¢ãƒ¼ãƒ‰ã€‘ï¼ˆã²ãŸã™ã‚‰ç‚¹æ»…ï¼‰</b><br>
                        RAã¨RBã‚’é€šã£ã¦ã‚³ãƒ³ãƒ‡ãƒ³ã‚µã«é›»æ°—ãŒæºœã¾ã‚‹ã¨OFFã€RBã‚’é€šã£ã¦é›»æ°—ãŒæŠœã‘ã‚‹ã¨ONã«ãªã‚Šã¾ã™ã€‚
                        RBã‚’RAã‚ˆã‚Šå¤§ããã™ã‚‹ã¨ã€ONã¨OFFã®æ™‚é–“ãŒè¿‘ããªã‚Šã€ãã‚Œã„ãªç‚¹æ»…ã«ãªã‚Šã¾ã™ã€‚<a href="https://raw.githubusercontent.com/kumoroha/ele/refs/heads/main/pic/555_mu-antei.png">å›è·¯å›³</a>&emsp;<a href="https://raw.githubusercontent.com/kumoroha/ele/refs/heads/main/pic/555_mu-antei-bb.png">å®Ÿè£…å›³</a>
                    </div>
                    <div class="ascii-art" id="diag_astable"></div>
                </div>
                <div>
                    <div class="mode-info">
                        <b>ã€å˜å®‰å®šãƒ¢ãƒ¼ãƒ‰ã€‘ï¼ˆã‚¿ã‚¤ãƒãƒ¼ï¼‰</b><br>
                        æ™®æ®µã¯OFFã§ã€2ç•ªãƒ”ãƒ³ã®ã‚¹ã‚¤ãƒƒãƒã‚’ã€Œãƒãƒãƒƒã€ã¨æŠ¼ã—ãŸç¬é–“ã ã‘ONã«ãªã‚Šã¾ã™ã€‚
                        æ™‚é–“ãŒéãã‚‹ã¨å‹æ‰‹ã«OFFã«æˆ»ã‚Šã¾ã™ã€‚RAã‚’å¤§ããã™ã‚‹ã¨ONæ™‚é–“ãŒä¼¸ã³ã¾ã™ã€‚<a href="https://raw.githubusercontent.com/kumoroha/ele/refs/heads/main/pic/555_tan-antei.png">å›è·¯å›³</a>&emsp;<a href="https://raw.githubusercontent.com/kumoroha/ele/refs/heads/main/pic/555_tan-antei-bb.png">å®Ÿè£…å›³</a>
                    </div>
                    <div class="ascii-art" id="diag_mono"></div>
                </div>
            </div>

            <table style="width:100%; border-collapse:collapse; margin-top:20px;" class="glossary">
                <tr><th>TRIG (2)</th><td>ã‚¿ã‚¤ãƒãƒ¼ã‚’ã€Œé–‹å§‹ã€ã•ã›ã‚‹ãƒ”ãƒ³ã€‚VCCã®1/3ä»¥ä¸‹ã®é›»åœ§ã§åå¿œã—ã¾ã™ã€‚</td></tr>
                <tr><th>OUT (3)</th><td>ã“ã“ã‹ã‚‰å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚LEDã®é•·ã„è¶³(ã‚¢ãƒãƒ¼ãƒ‰)ã‚’ã“ã“ã«ç¹‹ãã¾ã™ã€‚</td></tr>
                <tr><th>THRESH (6)</th><td>ã‚¿ã‚¤ãƒãƒ¼ã‚’ã€Œçµ‚äº†ã€ã•ã›ã‚‹ãƒ”ãƒ³ã€‚VCCã®2/3ä»¥ä¸Šã®é›»åœ§ã§åå¿œã—ã¾ã™ã€‚</td></tr>
                <tr><th>DISCH (7)</th><td>ã‚³ãƒ³ãƒ‡ãƒ³ã‚µã®é›»æ°—ã‚’ã€Œæ¨ã¦ã‚‹ã€ãƒ”ãƒ³ã€‚ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†æ™‚ã«å†…éƒ¨ã‚¹ã‚¤ãƒƒãƒãŒå…¥ã‚Šã¾ã™ã€‚</td></tr>
            </table>
        </div>
    </details>
</div>

<script>
const COLORS = [
    {n:"é»’", v:0, m:1, c:"#000", t:null}, {n:"èŒ¶", v:1, m:10, c:"#8b4513", t:1},
    {n:"èµ¤", v:2, m:100, c:"#f00", t:2}, {n:"æ©™", v:3, m:1000, c:"#ffa500", t:null},
    {n:"é»„", v:4, m:10000, c:"#ffff00", t:null}, {n:"ç·‘", v:5, m:100000, c:"#008000", t:0.5},
    {n:"é’", v:6, m:1000000, c:"#0000ff", t:0.25}, {n:"ç´«", v:7, m:10000000, c:"#800080", t:0.1},
    {n:"ç°", v:8, m:null, c:"#808080", t:0.05}, {n:"ç™½", v:9, m:null, c:"#fff", t:null},
    {n:"é‡‘", v:null, m:0.1, c:"#daa520", t:5}, {n:"éŠ€", v:null, m:0.01, c:"#c0c0c0", t:10}
];
const E24 = [1.0, 1.1, 1.2, 1.3, 1.5, 1.6, 1.8, 2.0, 2.2, 2.4, 2.7, 3.0, 3.3, 3.6, 3.9, 4.3, 4.7, 5.1, 5.6, 6.2, 6.8, 7.5, 8.2, 9.1];
const CAP_COMMON = [10, 15, 22, 33, 47, 68];

function toggleTheme() {
    const b = document.body;
    const currentTheme = b.getAttribute('data-theme');
    b.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
}

function numFix(num, digits=2) {
    if (!isFinite(num) || isNaN(num)) return "0";
    return parseFloat(num.toFixed(digits)).toString();
}

function getSafeE24(val) {
    if (val <= 0 || !isFinite(val)) return "0";
    const f = Math.pow(10, Math.floor(Math.log10(val)));
    const base = val / f;
    let next = E24.find(e => e >= base) || 1.0;
    const res = next * (next < base ? f * 10 : f);
    return numFix(res, 1);
}

function updateBandColor(el) {
    const v = parseInt(el.value);
    el.style.backgroundColor = COLORS[v].c;
    el.style.color = (v === 4 || v === 9 || v === 10 || v === 11) ? "black" : "white";
}

function toggleFifthBand() {
    document.getElementById('b5').style.display = (document.getElementById('res_type').value === "5") ? "block" : "none";
}

// ä¸¦åˆ—å…¥åŠ›æ¬„ã®å‹•çš„ç”Ÿæˆ
function updateParallelInputs() {
    const count = parseInt(document.getElementById('parallel_count').value);
    const area = document.getElementById('parallel_inputs_area');
    area.innerHTML = '';
    for (let i = 1; i <= count; i++) {
        const div = document.createElement('div');
        div.innerHTML = `<label>R${i} [Î©]</label><input type="number" id="pr${i}" value="100" oninput="calc()">`;
        area.appendChild(div);
    }
}

function init() {
    updateParallelInputs();
    ["b1", "b2", "b5", "b3", "b4"].forEach(id => {
        const sel = document.getElementById(id);
        COLORS.forEach((c, i) => {
            if((id==="b1"||id==="b2"||id==="b5") && c.v === null) return;
            if(id==="b3" && c.m === null) return;
            if(id==="b4" && c.t === null) return;
            const opt = new Option(c.n, i);
            opt.style.backgroundColor = c.c;
            opt.style.color = (i === 4 || i === 9 || i === 10 || i === 11) ? "black" : "white";
            sel.add(opt);
        });
        sel.value = (id==="b1")?1 : (id==="b2")?0 : (id==="b5")?0 : (id==="b3")?2 : 10;
        updateBandColor(sel);
    });
    calc();
}

function calc() {
    const vcc = parseFloat(document.getElementById('vcc').value) || 0;
    const vf = parseFloat(document.getElementById('vf').value) || 0;
    const v_eff = vcc - (document.getElementById('use_drop').checked ? 1.0 : 0);
    const ra = parseFloat(document.getElementById('ra').value) || 0;
    const rb = parseFloat(document.getElementById('rb').value) || 0;
    const c1 = parseFloat(document.getElementById('c1').value) || 0;
    const mode = document.getElementById('mode').value;
    const cVal = c1 / 1000000;

    // 1. LEDé †å¼•ã
    const tMa = parseFloat(document.getElementById('target_ma').value) || 0;
    if(v_eff > vf && tMa > 0) {
        const ri = (v_eff - vf) / (tMa/1000);
        document.getElementById('res_led').innerHTML = `æ¨å¥¨æŠµæŠ—: <span class="res-val">${getSafeE24(ri)}</span> Î© <br><span style="font-size: 0.9em; margin: 10px 0px 10px 0px;">(è¨ˆç®—ä¸Šã®ç†è«–å€¤:<span style="font-size: 1.4em;"> ${numFix(ri,0)}</span> Î©)</span>`;
    } else { document.getElementById('res_led').innerText = "é›»åœ§ä¸è¶³"; }

    // LEDé€†å¼•ãã®ä¿®æ­£
    const rsRev = parseFloat(document.getElementById('r_stock_rev').value) || 0;
    if(rsRev > 0 && v_eff > vf) {
        const revMa = (v_eff - vf) / rsRev * 1000;
        document.getElementById('res_rev_ma').innerText = numFix(revMa, 1);
    } else {
        document.getElementById('res_rev_ma').innerText = "0";
    }

    // 2. 555
    if(mode === 'mono') {
        document.getElementById('rb_group').style.opacity = 0.3;
        document.getElementById('res_555').innerHTML = `ã‚¿ã‚¤ãƒãƒ¼ONæ™‚é–“: <span class="res-val">${numFix(1.1 * ra * 1000 * cVal, 2)}</span> ç§’`;
    } else {
        document.getElementById('rb_group').style.opacity = 1;
        const hz = 1.44 / (((ra*1000) + 2 * (rb*1000)) * cVal);
        const duty = ((ra + rb) / (ra + 2 * rb)) * 100;
        document.getElementById('res_555').innerHTML = `ç™ºæŒ¯å‘¨æ³¢æ•°: <span class="res-val">${numFix(hz, 2)}</span> Hz<br><span style="font-size: 1.0em;">ãƒ‡ãƒ¥ãƒ¼ãƒ†ã‚£æ¯” (ONæ™‚é–“): <span class="res-val" style="font-size:1.4em;">${numFix(duty, 1)}</span> %</span>`;
    }

    // 555é€†å¼•ã
    const targetVal = parseFloat(document.getElementById('target_val').value) || 1;
    const targetUnit = document.getElementById('target_unit').value;
    const raFix = parseFloat(document.getElementById('ra_fix').value) || 1; 

    if(mode === 'astable') {
        const tHz = (targetUnit === 'hz') ? targetVal : 1 / targetVal;
        const rbNeeded_ohm = ((1.44 / (tHz * cVal)) - (raFix * 1000)) / 2;
        const rbNeeded_kohm = rbNeeded_ohm / 1000;
        document.getElementById('res_555_rev').innerHTML = 
            `å¿…è¦ RB: <span class="res-val rev">${numFix(rbNeeded_kohm, 2)}</span> kÎ©<br>` +
            `æ¨å¥¨(E24): <span class="res-val rev">${getSafeE24(rbNeeded_ohm) / 1000}</span> kÎ©`;
    } else {
        const tSec = (targetUnit === 'sec') ? targetVal : 1 / targetVal;
        const raNeeded_ohm = tSec / (1.1 * cVal);
        const raNeeded_kohm = raNeeded_ohm / 1000;
        document.getElementById('res_555_rev').innerHTML = 
            `å¿…è¦ RA: <span class="res-val rev">${numFix(raNeeded_kohm, 2)}</span> kÎ©<br>` +
            `æ¨å¥¨(E24): <span class="res-val rev">${getSafeE24(raNeeded_ohm) / 1000}</span> kÎ©`;
    }

    // å›è·¯å›³
    const sRa = `<span class="dyn-val">${numFix(ra,1)}</span>`;
    const sRb = `<span class="dyn-val">${numFix(rb,1)}</span>`;
    const sC1 = `<span class="dyn-val">${numFix(c1,1)}</span>`;
    document.getElementById('diag_astable').innerHTML = `ã€ç„¡å®‰å®šï¼šãšã£ã¨ç‚¹æ»…ã€‘\n  VCC(+)\n    â”‚\n    â”œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚  â”‚       â”‚\n [RA:${sRa}k]       â”‚    (8)VCC\n    â”‚  â”‚       â”‚\n    â”œâ”€â”€â”¼â”€â”€(7)DISCH\n    â”‚  â”‚       â”‚\n [RB:${sRb}k]     â”‚\n    â”‚  â”‚       â”‚\n    â”œâ”€â”¬â”´â”€â”€(6)THRESH\n    â”‚ â”‚        â”‚\n    â”‚ â””â”€â”€(2)TRIG\n    â”‚          â”‚\n [C1:${sC1}Î¼F]    â””â”€â”€(3)OUT â”€â”€ [LEDç­‰]\n    â”‚\n   GND`;
    document.getElementById('diag_mono').innerHTML = `ã€å˜å®‰å®šï¼šãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€‘\n  VCC(+)\n    â”‚\n    â”œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚  â”‚       â”‚\n [RA:${sRa}k]       â”‚    (8)VCC\n    â”‚  â”‚       â”‚\n    â”œâ”€â”€â”´â”€â”€â”¬â”€â”€(7)DISCH\n    â”‚     â””â”€â”€(6)THRESH\n [C1:${sC1}Î¼F]  (3)OUT â”€â”€ [LEDç­‰]\n    â”‚          â”‚\n   GND    SW â”€(2)TRIG\n               â”‚\n              (1)GND`;

    // 4 & 6. ä¸¦åˆ—è¨ˆç®— (æ‹¡å¼µå¯¾å¿œ)
    let invSum = 0;
    const count = parseInt(document.getElementById('parallel_count').value);
    for (let i = 1; i <= count; i++) {
        const val = parseFloat(document.getElementById('pr'+i).value);
        if (val > 0) invSum += (1 / val);
    }
    document.getElementById('res_parallel').innerText = invSum > 0 ? numFix(1 / invSum, 1) : "---";

    // 5. ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
    const resType = document.getElementById('res_type').value;
    const v1 = parseInt(COLORS[document.getElementById('b1').value].v);
    const v2 = parseInt(COLORS[document.getElementById('b2').value].v);
    const mult = COLORS[document.getElementById('b3').value].m;
    let sigRes = 0;
    if(resType === "5") {
        sigRes = v1 * 100 + v2 * 10 + parseInt(COLORS[document.getElementById('b5').value].v);
    } else {
        sigRes = v1 * 10 + v2;
    }
    const rv = sigRes * mult;
    document.getElementById('res_color').innerHTML = `${rv >= 1000 ? numFix(rv/1000, 2)+'k' : numFix(rv, 0)} Î© (Â±${COLORS[document.getElementById('b4').value].t}%)`;
    document.getElementById('existence_msg_res').innerText = E24.some(e => e.toFixed(1) === (sigRes / (resType==="5"?100:10)).toFixed(1)) ? "" : "ï¼ˆä¸€èˆ¬çš„ã§ã¯ãªã„æ•°å€¤ã§ã™ï¼‰";

    // 7. ã‚³ãƒ³ãƒ‡ãƒ³ã‚µ
    const cap = document.getElementById('cap_code').value;
    if(cap.length === 3) {
        const c_sig = parseInt(cap.substring(0,2)), c_exp = parseInt(cap.substring(2,3));
        const pf = c_sig * Math.pow(10, c_exp), uf = pf / 1000000, nf = pf / 1000;
        document.getElementById('res_cap').innerHTML = uf >= 0.1 ? numFix(uf, 3)+' Î¼F' : (nf >= 0.1 ? numFix(nf, 1)+' nF' : pf+' pF');
        document.getElementById('existence_msg_cap').innerText = CAP_COMMON.includes(c_sig) ? "" : "ï¼ˆä¸€èˆ¬çš„ã§ã¯ãªã„æ•°å€¤ã§ã™ï¼‰";
    }
}
init();
</script>
</body>
</html>

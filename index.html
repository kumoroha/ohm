<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>é›»å­å·¥ä½œ ç©¶æ¥µã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ãƒ„ãƒ¼ãƒ«</title>
    <style>
        :root { --primary: #0284c7; --bg: #f1f5f9; --card: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #334155; padding: 20px; line-height: 1.4; }
        .container { max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); gap: 20px; align-items: start; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); min-height: 380px; }
        h2 { font-size: 1.1em; color: var(--primary); border-bottom: 2px solid #e2e8f0; padding-bottom: 6px; margin: 0 0 12px 0; }
        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.85em; font-weight: bold; color: #64748b; margin-bottom: 4px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; font-size: 1em; }
        .result-box { margin-top: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px; border: 1px solid #bae6fd; font-size: 1em; line-height: 1.5; }
        .res-val { color: #0369a1; font-weight: bold; font-size: 1.25em; }
        .safety-hint { color: #059669; font-size: 0.85em; font-weight: bold; margin-top: 5px; display: block; }
        .warning { color: #dc2626; font-size: 0.9em; font-weight: bold; }
        
        /* æŠµæŠ—è§£èª­ã‚³ãƒ³ãƒ†ãƒŠã®æ‹¡å¼µï¼š2åˆ—åˆ†ã‚’å æœ‰ */
        .card-large { grid-column: span 2; }
        @media (max-width: 800px) { .card-large { grid-column: span 1; } }

        .band-row { display: flex; gap: 8px; margin-top: 15px; }
        .band-select { flex: 1; height: 60px; border-radius: 8px; cursor: pointer; border: 2px solid #cbd5e1; font-weight: bold; text-align: center; font-size: 0.9em; transition: transform 0.1s; }
        .band-select:hover { transform: scale(1.02); }
        .band-label-grid { display: flex; gap: 8px; margin-top: 5px; text-align: center; font-size: 0.75em; color: #64748b; font-weight: bold; }
        .band-label-grid span { flex: 1; }

        details { background: var(--card); margin-top: 30px; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden; }
        summary { padding: 15px 20px; font-weight: bold; cursor: pointer; background: #e2e8f0; color: #1e293b; outline: none; }
        .details-content { padding: 20px; }
        .ascii-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .ascii-art { font-family: 'Consolas', 'Monaco', 'Courier New', monospace; background: #1e293b; color: #00ff41; padding: 20px; border-radius: 8px; font-size: 0.85em; line-height: 1.2; overflow-x: auto; white-space: pre; }
        .glossary { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9em; }
        .glossary th, .glossary td { border: 1px solid #cbd5e1; padding: 10px; text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color:#1e293b; margin-bottom:25px;">é›»å­å·¥ä½œ ç©¶æ¥µã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ãƒ„ãƒ¼ãƒ«</h1>

    <div class="grid">
        <div class="card">
            <h2>1. LEDæŠµæŠ—è¨­è¨ˆ (å®‰å…¨å„ªå…ˆ)</h2>
            <div class="input-group"><label>é›»æºé›»åœ§ (Vcc) [V]</label><input type="number" id="vcc" value="5.0" step="0.1" oninput="calc()"></div>
            <div class="input-group"><label><input type="checkbox" id="use_drop" onchange="calc()" style="width:auto;"> ICãƒ‰ãƒ­ãƒƒãƒ—è€ƒæ…® (NE555ä½¿ç”¨æ™‚ç­‰)</label></div>
            <div class="input-group"><label>LEDã®Vf [V]</label><input type="number" id="vf" value="3.1" step="0.1" oninput="calc()"></div>
            <div class="input-group"><label>ç›®æ¨™é›»æµ [mA/åˆ—]</label><input type="number" id="target_ma" value="20" oninput="calc()"></div>
            <div class="result-box" id="res_led">---</div>
            <span class="safety-hint">â€»ç„¼ãåˆ‡ã‚Œé˜²æ­¢ã®ãŸã‚ã€ç†è«–å€¤ã‚ˆã‚Šå¤§ãã„è¿‘ä¼¼å€¤ã‚’é¸æŠã€‚</span>
        </div>

        <div class="card">
            <h2>2. 555 è¨­å®š (è¨ˆç®—)</h2>
            <div class="input-group"><label>å‹•ä½œãƒ¢ãƒ¼ãƒ‰</label><select id="mode" onchange="calc()"><option value="astable">ç„¡å®‰å®š (ç‚¹æ»…)</option><option value="mono">å˜å®‰å®š (ã‚¿ã‚¤ãƒãƒ¼)</option></select></div>
            <div class="input-group"><label>ã‚³ãƒ³ãƒ‡ãƒ³ã‚µ [Î¼F]</label><input type="number" id="c1" value="100" oninput="calc()"></div>
            <div class="input-group"><label>æŠµæŠ— RA [kÎ©]</label><input type="number" id="ra" value="10" oninput="calc()"></div>
            <div id="rb_group" class="input-group"><label>æŠµæŠ— RB [kÎ©]</label><input type="number" id="rb" value="47" oninput="calc()"></div>
            <div class="result-box" id="res_555">---</div>
        </div>

        <div class="card">
            <h2>3. 555 é€†å¼•ã (æŠµæŠ—ç®—å‡º)</h2>
            <div class="input-group"><label>ã€å˜å®‰å®šã€‘ç›®æ¨™æ™‚é–“ [ç§’]</label><input type="number" id="target_sec" value="1.0" step="0.1" oninput="calc()"></div>
            <div class="result-box" id="res_mono_inv">---</div>
            <div class="input-group" style="margin-top:20px;"><label>ã€ç„¡å®‰å®šã€‘ç›®æ¨™å‘¨æ³¢æ•° [Hz]</label><input type="number" id="target_hz" value="1.0" step="0.1" oninput="calc()"></div>
            <div class="result-box" id="res_astable_inv">---</div>
        </div>

        <div class="card">
            <h2>4. åˆæˆ / 6. é›»æµé€†å¼•ã</h2>
            <div class="input-group"><label>ä¸¦åˆ—æŠµæŠ—1 [Î©]</label><input type="number" id="comb_r1" value="100" oninput="calc()"></div>
            <div class="input-group"><label>ä¸¦åˆ—æŠµæŠ—2 [Î©]</label><input type="number" id="comb_r2" value="100" oninput="calc()"></div>
            <div class="result-box">ä¸¦åˆ—åˆæˆ: <span class="res-val" id="res_parallel">---</span> Î©</div>
            <div class="input-group" style="margin-top:20px;"><label>åœ¨åº«æŠµæŠ— [Î©] â†’ æµã‚Œã‚‹é›»æµã‚’è¨ˆç®—</label><input type="number" id="r_stock" value="100" oninput="calc()"></div>
            <div class="result-box" id="res_stock_ma">---</div>
        </div>

        <div class="card card-large">
            <h2>5. æŠµæŠ—ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰è§£èª­ (4/5æœ¬å¸¯å¯¾å¿œãƒ»ç²¾åº¦è¡¨ç¤ºä»˜)</h2>
            <div style="max-width: 600px; margin: auto;">
                <div class="input-group">
                    <label>æŠµæŠ—ã®ç¨®é¡ã‚’é¸æŠ</label>
                    <select id="res_type" onchange="toggleFifthBand();calc()">
                        <option value="4">ä¸€èˆ¬æŠµæŠ— (4æœ¬å¸¯ï¼šèŒ¶ãƒ»èµ¤ãƒ»æ©™...)</option>
                        <option value="5">ç²¾å¯†æŠµæŠ— (5æœ¬å¸¯ï¼šé‡‘å±çš®è†œæŠµæŠ—ãªã©)</option>
                    </select>
                </div>
                <div class="band-row">
                    <select id="b1" class="band-select" onchange="updateBandColor(this);calc()"></select>
                    <select id="b2" class="band-select" onchange="updateBandColor(this);calc()"></select>
                    <select id="b5" class="band-select" onchange="updateBandColor(this);calc()" style="display:none;"></select>
                    <select id="b3" class="band-select" onchange="updateBandColor(this);calc()"></select>
                    <select id="b4" class="band-select" onchange="updateBandColor(this);calc()"></select>
                </div>
                <div class="band-label-grid" id="band_labels">
                    <span>ç¬¬1è‰²</span><span>ç¬¬2è‰²</span><span id="label_b5" style="display:none;">ç¬¬3è‰²</span><span>ä¹—æ•°</span><span>è¨±å®¹èª¤å·®</span>
                </div>
                <div class="result-box" style="text-align: center;">
                    <span id="res_color" class="res-val" style="font-size: 2em;">---</span>
                </div>
            </div>
        </div>
    </div>

    <details>
        <summary>ğŸ’¡ NE555 / LMC555 æ¥ç¶šå›³ & ç”¨èªè§£èª¬</summary>
        <div class="details-content">
            <div class="ascii-grid">
                <div class="ascii-art">
<span style="color:#fff;font-weight:bold;">ã€ç„¡å®‰å®šãƒ¢ãƒ¼ãƒ‰ï¼šLãƒã‚«ãƒ»ç™ºæŒ¯å›è·¯ã€‘</span>
  VCC(+) 5Vã€œ15V
    â”‚
    â”œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚       â”‚
  [RA] â”‚    (8)VCC  â†é›»æºæ­£æ¥µ
    â”‚  â”‚       â”‚
    â”œâ”€â”€â”¼â”€â”€(7)DISCH  â†RAã¨RBã®æ¥ç‚¹ã‚’7ç•ªã¸
    â”‚  â”‚       â”‚
  [RB] â”‚       â”‚      NE555 / LMC555
    â”‚  â”‚       â”‚     +-------U-------+
    â”œâ”€â”¬â”´â”€â”€(6)THRESH 1| GND       VCC |8
    â”‚ â”‚        â”‚    2| TRIG    DISCH |7
    â”‚ â””â”€â”€â”€(2)TRIG   3| OUT    THRESH |6
    â”‚          â”‚    4| RESET    CONT |5
  [C1]  â”Œâ”€â”€(3)OUT    +---------------+
    â”‚   â”‚      â”‚
    â””â”€â”€â”€â”¼â”€â”€(1)GND   
        â”‚      â”‚
       GND    (4)RESET
                </div>
                <div class="ascii-art">
<span style="color:#fff;font-weight:bold;">ã€å˜å®‰å®šãƒ¢ãƒ¼ãƒ‰ï¼šã‚¿ã‚¤ãƒãƒ¼ãƒ»ãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€‘</span>
  VCC(+)
    â”‚
    â”œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚       â”‚
  [RA] â”‚    (8)VCC
    â”‚  â”‚       â”‚
    â”œâ”€â”€â”´â”€â”€â”¬â”€(7)DISCH
    â”‚      â””â”€(6)THRESH
  [C1]         â”‚      NE555 / LMC555
    â”‚          â”‚     +-------U-------+
   GND         â”‚    1| GND       VCC |8
               â”‚    2| TRIG    DISCH |7
  å…¥åŠ›SW       â”œâ”€(2)TRIG 3| OUT    THRESH |6
    â””â”€â—‹ â—‹â”€â”€â”´â”€(3)OUT  4| RESET    CONT |5
               â”‚     +---------------+
              (1)GND
                </div>
            </div>
            <table class="glossary">
                <tr><th>TRIG (2)</th><td>ãƒˆãƒªã‚¬ãƒ¼ã€‚1/3 VCCä»¥ä¸‹ã«ãªã‚‹ã¨ONã€‚</td></tr>
                <tr><th>OUT (3)</th><td>å‡ºåŠ›ã€‚æœ€å¤§200mA(NE) / 50mA(LMC)ç¨‹åº¦ã€‚</td></tr>
                <tr><th>THRESH (6)</th><td>ã—ãã„å€¤ã€‚2/3 VCCã‚’è¶…ãˆã‚‹ã¨OFFã€‚</td></tr>
                <tr><th>DISCH (7)</th><td>æ”¾é›»ã€‚ã‚³ãƒ³ãƒ‡ãƒ³ã‚µã®é›»æ°—ã‚’æŠœãã‚¹ã‚¤ãƒƒãƒã€‚</td></tr>
            </table>
        </div>
    </details>
</div>

<script>
const COLORS = [
    {n:"é»’", v:0, m:1, c:"#000", t:null}, {n:"èŒ¶", v:1, m:10, c:"#8b4513", t:1},
    {n:"èµ¤", v:2, m:100, c:"#f00", t:2}, {n:"æ©™", v:3, m:1000, c:"#ffa500", t:null},
    {n:"é»„", v:4, m:10000, c:"#ffff00", t:null}, {n:"ç·‘", v:5, m:100000, c:"#008000", t:0.5},
    {n:"é’", v:6, m:1000000, c:"#0000ff", t:0.25}, {n:"ç´«", v:7, m:10000000, c:"#800080", t:0.1},
    {n:"ç°", v:8, m:null, c:"#808080", t:0.05}, {n:"ç™½", v:9, m:null, c:"#fff", t:null},
    {n:"é‡‘", v:null, m:0.1, c:"#daa520", t:5}, {n:"éŠ€", v:null, m:0.01, c:"#c0c0c0", t:10}
];

function getSafeE24(val) {
    const e24 = [1.0, 1.1, 1.2, 1.3, 1.5, 1.6, 1.8, 2.0, 2.2, 2.4, 2.7, 3.0, 3.3, 3.6, 3.9, 4.3, 4.7, 5.1, 5.6, 6.2, 6.8, 7.5, 8.2, 9.1];
    if (val <= 0 || !isFinite(val)) return 0;
    const log10 = Math.floor(Math.log10(val));
    const factor = Math.pow(10, log10);
    const base = val / factor;
    let nextBase = e24.find(e => e >= base);
    if (!nextBase) return (1.0 * factor * 10).toFixed(0);
    return (nextBase * factor).toFixed(nextBase * factor < 10 ? 1 : 0);
}

function formatResistor(val) {
    if (val >= 1000000 && val % 1000000 === 0) return (val / 1000000) + "M";
    if (val >= 1000) return (val / 1000).toFixed(1).replace(/\.0$/, '') + "k";
    return Math.round(val);
}

function init() {
    ["b1", "b2", "b5", "b3", "b4"].forEach((id) => {
        const sel = document.getElementById(id);
        COLORS.forEach((c, i) => {
            if((id==="b1"||id==="b2"||id==="b5") && c.v === null) return;
            if(id==="b3" && c.m === null) return;
            if(id==="b4" && c.t === null) return;
            const opt = new Option(c.n, i);
            opt.style.backgroundColor = c.c;
            opt.style.color = (i === 4 || i === 9 || i === 10 || i === 11) ? "black" : "white";
            sel.add(opt);
        });
        sel.value = (id==="b1")?1 : (id==="b2")?0 : (id==="b5")?0 : (id==="b3")?2 : 10;
        updateBandColor(sel);
    });
    calc();
}

function toggleFifthBand() {
    const is5 = (document.getElementById('res_type').value === "5");
    document.getElementById('b5').style.display = is5 ? "block" : "none";
    document.getElementById('label_b5').style.display = is5 ? "block" : "none";
}

function updateBandColor(el) {
    const v = parseInt(el.value);
    el.style.backgroundColor = COLORS[v].c;
    el.style.color = (v === 4 || v === 9 || v === 10 || v === 11) ? "black" : "white";
}

function calc() {
    const cVal = (parseFloat(document.getElementById('c1').value) || 0) / 1000000;
    const vcc = parseFloat(document.getElementById('vcc').value) || 0;
    const vf = parseFloat(document.getElementById('vf').value) || 0;
    const v_eff = vcc - (document.getElementById('use_drop').checked ? 1.0 : 0);
    const targetMa = parseFloat(document.getElementById('target_ma').value) || 0;

    if (v_eff > vf) {
        const r_ideal = (v_eff - vf) / (targetMa / 1000);
        document.getElementById('res_led').innerHTML = `ç†è«–å€¤: ${Math.round(r_ideal)} Î©<br>æ¨å¥¨: <span class="res-val">${getSafeE24(r_ideal)}</span> Î© (E24ä¸Šä½)`;
    } else { document.getElementById('res_led').innerHTML = '<span class="warning">é›»åœ§ä¸è¶³</span>'; }

    const ra = (parseFloat(document.getElementById('ra').value) || 0) * 1000;
    const rb = (parseFloat(document.getElementById('rb').value) || 0) * 1000;
    if(document.getElementById('mode').value === 'mono') {
        document.getElementById('rb_group').style.display = 'none';
        document.getElementById('res_555').innerHTML = `ã‚¿ã‚¤ãƒãƒ¼: <span class="res-val">${(1.1 * ra * cVal).toFixed(2)}</span> ç§’`;
    } else {
        document.getElementById('rb_group').style.display = 'block';
        document.getElementById('res_555').innerHTML = `å‘¨æ³¢æ•°: <span class="res-val">${(1.44 / ((ra + 2 * rb) * cVal)).toFixed(2)}</span> Hz`;
    }

    const tSec = parseFloat(document.getElementById('target_sec').value) || 0;
    const tHz = parseFloat(document.getElementById('target_hz').value) || 0;
    if(cVal > 0) {
        document.getElementById('res_mono_inv').innerHTML = `å¿…è¦ RA: <span class="res-val">${(tSec / (1.1 * cVal) / 1000).toFixed(1)}</span> kÎ©`;
        const invRb = (1.44 / (tHz * cVal) - 10000) / 2;
        document.getElementById('res_astable_inv').innerHTML = invRb > 0 ? `å¿…è¦ RB: <span class="res-val">${(invRb/1000).toFixed(1)}</span> kÎ©` : '<span class="warning">ä¸å¯</span>';
    }

    // æŠµæŠ—ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆç²¾åº¦è¡¨ç¤ºè¿½åŠ ï¼‰
    const is5 = document.getElementById('res_type').value === "5";
    let colorVal = is5 ? (COLORS[document.getElementById('b1').value].v * 100 + COLORS[document.getElementById('b2').value].v * 10 + COLORS[document.getElementById('b5').value].v) * COLORS[document.getElementById('b3').value].m
                       : (COLORS[document.getElementById('b1').value].v * 10 + COLORS[document.getElementById('b2').value].v) * COLORS[document.getElementById('b3').value].m;
    const tolerance = COLORS[document.getElementById('b4').value].t;
    document.getElementById('res_color').innerHTML = `${formatResistor(colorVal)} Î© <span style="font-size: 0.5em; color: #64748b;">(Â±${tolerance}%)</span>`;

    const r1 = parseFloat(document.getElementById('comb_r1').value) || 0;
    const r2 = parseFloat(document.getElementById('comb_r2').value) || 0;
    document.getElementById('res_parallel').innerText = r1*r2 ? Math.round((r1*r2)/(r1+r2)) : 0;
    const rS = parseFloat(document.getElementById('r_stock').value) || 0;
    document.getElementById('res_stock_ma').innerHTML = `äºˆæ¸¬é›»æµ: <span class="res-val">${(rS > 0 && v_eff > vf ? ((v_eff - vf) / rS) * 1000 : 0).toFixed(1)}</span> mA`;
}
init();
</script>
</body>
</html>
